<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data noupdate="0">
        <template id="conekta_acquirer_button">
            <form method="post" t-att-action="tx_url" target="_self">
                <button t-att-class="submit_class" type="submit" width="100px">
                    <img src="/payment_conekta/static/src/img/conekta_icon.png" t-if="not submit_txt"/>
                    <span t-if="submit_txt">
                        <t t-esc="submit_txt"/>
                        <span class="fa fa-long-arrow-right"/>
                    </span>
                </button>
            </form>
        </template>
        <template id="conekta_card" inherit_id="website_sale.payment">
            <xpath expr="//div[@class='col-lg-3 col-sm-3']" position="before">
                <t t-set="head">
                    <script src="https://conektaapi.s3.amazonaws.com/v0.3.2/js/conekta.js" type="text/javascript"/>
                </t>
                <script type="text/javascript">
                    Conekta.setPublishableKey('<t t-esc="conekta.conekta_public_key"/>');
                </script>
                <t t-set="conekta_id" t-value='request.env["payment.acquirer"].search([("provider", "=", "conekta")]).id'/>
                <script>
                    function showConektaForm(){
                        var $form = $("#card-form");
                        var $input = $("input[checked='True']")
                        if ($input.val() == '<t t-esc="conekta_id"/>'){
                            $form.show().size();
                        };
                    }
                    window.onload = showConektaForm;
                    $("input[name='acquirer']").change(function(){
                        var $form = $("#card-form");
                        $form.hide();
                        if ($(this).val() == '<t t-esc="conekta_id"/>'){
                            $form.show().size();
                        };
                    });
                </script>
                <script src="../../payment_conekta/static/src/js/conekta.js"/>
                <div class="col-md-7 col-sm-7">
                    <form style="display: none;" class="s_website_form form-horizontal container-fluid mt32" action="/conekta/charge" id="card-form" method="POST">
                        <span class="card-errors"/>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Cardholder Name</label>
                            <div class="col-md-7 col-sm-8">
                                <input data-conekta="card[name]" type="text" class="form-control o_website_form_input" size="20"/>
                            </div>
                        </div>
                        <div id="card-number-div" class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Card Number</label>
                            <div class="col-md-7 col-sm-8">
                                <input id="conekta-card-number" data-conekta="card[number]" type="text" class="form-control o_website_form_input" size="20" onkeyup="getCardInfo()"/>
                                <div align="right">
                                    <img id="all-cards" width="120" src="/payment_conekta/static/src/img/all-cards.png"/>
                                    <img id="visa" width="120" style="display: none;" src="/payment_conekta/static/src/img/visa.png"/>
                                    <img id="mastercard" width="120" style="display: none;" src="/payment_conekta/static/src/img/mastercard.png"/>
                                    <img id="amex" width="120" style="display: none;" src="/payment_conekta/static/src/img/amex.png"/>
                                </div>
                            </div>
                        </div>
                        <div id="cvc-div" class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">CVC</label>
                            <div class="col-md-2 col-sm-3">
                                <input id="cvc" onkeyup="validateCVC()" data-conekta="card[cvc]" type="text" class="form-control o_website_form_input" size="4"/>
                            </div>
                        </div>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Expiration date (MM/YYYY)</label>
                            <div class="col-md-7 col-sm-8">
                                <div class="col-md-4 col-sm-4">
                                    <input data-conekta="card[exp_month]" type="text" class="form-control o_website_form_input" size="2"/>
                                </div>
                                <span>/</span>
                                <div class="col-md-4 col-sm-4">
                                    <input data-conekta="card[exp_year]" type="text" class="form-control o_website_form_input" size="4"/>
                                </div>
                            </div>
                        </div>
                        <!-- InformaciÃ³n recomendada para sistema antifraude -->
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Street</label>
                            <div class="col-md-7 col-sm-8">
                                <input data-conekta="card[address][street1]" type="text" class="form-control o_website_form_input" size="25"/>
                            </div>
                        </div>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Street 2</label>
                            <div class="col-md-7 col-sm-8">
                                <input data-conekta="card[address][street2]" type="text" class="form-control o_website_form_input" size="25"/>
                            </div>
                        </div>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">City</label>
                            <div class="col-md-7 col-sm-8">
                                <input data-conekta="card[address][city]" type="text" class="form-control o_website_form_input" size="25"/>
                            </div>
                        </div>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Country</label>
                            <div class="col-md-7 col-sm-8">
                                <select name="country_id" class="form-control">
                                    <option value="0">Country...</option>
                                    <t t-foreach="request.env['res.country'].search([])" t-as="country">
                                        <option t-att-value="country.id" t-att-data-conekta="'card[address][' + country.name + ']'">
                                            <t t-esc="country.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                        </div>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">State</label>
                            <div class="col-md-7 col-sm-8">
                                <select name="state_id" class="form-control">
                                    <option value="0">State...</option>
                                    <t t-foreach="request.env['res.country.state'].search([])" t-as="state">
                                        <!-- TODO: filter states by country like addons/website_sale/static/src/website_sale.js:335 -->
                                        <option t-att-value="state.id" t-att-data-conekta="'card[address][' + state.name + ']'">
                                            <t t-esc="state.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                        </div>
                        <div class="form-group form-field o_website_form_required">
                            <label class="col-md-3 col-sm-4">Zip</label>
                            <div class="col-md-2 col-sm-3">
                                <input data-conekta="card[address][zip]" type="text" class="form-control o_website_form_input" size="5"/>
                            </div>
                        </div>
                    </form>
                </div>
            </xpath>
        </template>
    </data>
</openerp>